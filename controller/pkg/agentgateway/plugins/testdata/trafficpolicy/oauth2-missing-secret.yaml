apiVersion: agentgateway.dev/v1alpha1
kind: AgentgatewayPolicy
metadata:
  name: oauth2-missing-secret
  namespace: default
spec:
  targetRefs:
  - kind: Gateway
    name: test
    group: gateway.networking.k8s.io
  traffic:
    phase: PreRouting
    oauth2:
      authorizationEndpoint: https://issuer.example.com/authorize
      tokenEndpoint: https://issuer.example.com/token
      clientId: agw-client
      clientSecret:
        secretRef:
          name: missing-secret
          key: client-secret
      redirectUri: https://gateway.example.com/oauth2/callback

---
# Output
output: null
status:
  ancestors:
  - ancestorRef:
      group: gateway.networking.k8s.io
      kind: Gateway
      name: test
      namespace: default
    conditions:
    - lastTransitionTime: fake
      message: oauth2 client secret missing-secret not found
      reason: Invalid
      status: "True"
      type: Accepted
    - lastTransitionTime: fake
      message: Policy is not attached due to invalid status
      reason: Pending
      status: "False"
      type: Attached
    controllerName: agentgateway.dev/agentgateway
